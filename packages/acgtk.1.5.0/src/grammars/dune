;; -*-lisp-*-

(ocamllex data_lexer term_lexer)

(menhir
; (flags (--explain --table --compile-errors /home/pogodall/work/dev/ACGtk/src/grammars/term_parser_test.messages))
 (flags (--explain --table))
 (modules term_parser_test))

(menhir
 (merge_into data_parser)
 (flags (--explain --table --strict))
 (modules file_parser sig_parser lex_parser term_type_parser bound_term_parser))


;; Rule to generate the automatic message file
(rule
 (targets data_parser.messages.automatic)
 (deps (:parsers file_parser.mly lex_parser.mly sig_parser.mly term_type_parser.mly bound_term_parser.mly))
 (action
  (with-stdout-to data_parser.messages.automatic (run menhir --base data_parser --explain --table --list-errors %{parsers})))
 )

;; Rule to generate the message file
(rule
 (targets data_parser.messages.new)
 (deps (:parsers file_parser.mly lex_parser.mly sig_parser.mly term_type_parser.mly bound_term_parser.mly))
 (action (with-stdout-to data_parser.messages.new (run menhir --base data_parser --explain --table --update-errors data_parser.messages %{parsers}))
  )
 )

(alias
 (name update)
 (action (diff data_parser.messages data_parser.messages.new))
 )

(alias
 (name check)
 (deps
  data_parser.messages.automatic
  data_parser.messages
  (:parsers file_parser.mly lex_parser.mly sig_parser.mly term_type_parser.mly bound_term_parser.mly)
  )
 (action (run menhir --base data_parser --explain --table --compare-errors data_parser.messages.automatic --compare-errors data_parser.messages %{parsers}))
 )

;; This stanza declares the Grammar library
(library
 (name grammars)
  (flags (:standard -w -58))
  (modules (:standard \ acgc interactive term_test))
  (libraries
   menhirLib
   logic
   acgData
   )
  )

;; This declares the acgc executable implemented by acgc.ml
(executable
 (name acgc)
 (public_name acgc)
 (package acgtk)
 (modules acgc)
 (libraries
  logs
  fmt.tty
  logic
  acgData
  grammars
  ))

(test
 (name term_test)
 (modules term_test)
 (libraries
  menhirLib
  utilsLib
  grammars)
 )



(documentation (package acgtkLib))
