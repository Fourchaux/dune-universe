archetype lang_formula_asset_api

asset my_asset identified by id {
  id : string;
  value : int;
} initialized by {
  {"id0"; 0};
  {"id1"; 1};
  {"id2"; 2}
}

action exec (x : int) {

  specification {
    (* quantifiers *)
    q1: forall x : int, x = x;
    q2: forall x in my_asset, x.value = x.value;
    q3: exists x : int, x = x;
    q4: exists x in my_asset, x.value = x.value;

    (* formula operators *)
    o1: true -> true;  (* Mimply *)
    o2: true <-> true; (* Mequiv *)

    (* formula asset collection *)
    s1: before.my_asset.isempty();       (* Msetbefore *)
    s2: at(lbl).my_asset.isempty();      (* Msetat *)
    s3: unmoved.my_asset.isempty();      (* Msetunmoved *)
    s4: added.my_asset.isempty();        (* Msetadded *)
    s5: removed.my_asset.isempty();      (* Msetremoved *)

    (* formula asset collection methods *)
    f01: let some a = my_asset.get("id0") in true otherwise false;      (* Mapifget      *)
    f02: my_asset.subsetof(my_asset);                                   (* Mapifsubsetof *)
    f03: my_asset.isempty();                                            (* Mapifisempty  *)
    f04: my_asset.select(the.value > 0).isempty();                      (* Mapifselect   *)
    f05: my_asset.sort(value).isempty();                                (* Mapifsort     *)
    f06: my_asset.contains("key");                                      (* Mapifcontains *)
    f07: let some a = my_asset.nth(0) in a.value = 0 otherwise false;   (* Mapifnth      *)
    f08: my_asset.count() = 0;                                          (* Mapifcount    *)
    f09: my_asset.sum(the.value) = 0;                                   (* Mapifsum      *)
    f10: let some a = my_asset.max(the.value) in a = 0 otherwise false; (* Mapifmax      *)
    f11: let some a = my_asset.min(the.value) in a = 0 otherwise false; (* Mapifmin      *)
    f12: my_asset.head(2).isempty();                                    (* Mapifhead     *)
    f13: my_asset.tail(2).isempty();                                    (* Mapiftail     *)
    f14: before.x = 0;
    f15: at(lbl).x = 0;
  }

  effect {
    my_asset.add({"id3"; 3});
    label lbl;
    my_asset.add({"id4"; 4});
    require(x = 0)
  }
}


action exec2 () {
  specification {
    postcondition p1 {
      true
      invariant for loop {
         iterated.isempty() (* Msetiterated *)
      }
    }

    postcondition p1 {
      true
      invariant for loop {
         toiterate.isempty() (* Msettoiterate *)
      }
    }
  }

  effect {
    var res : int = 0;
    for:loop i in my_asset do
      res += 1;
    done
  }
}