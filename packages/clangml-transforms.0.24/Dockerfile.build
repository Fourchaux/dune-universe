FROM clangml-transforms
RUN git pull
RUN cd /home/opam/memcad && git pull
COPY --chown=opam Makefile dune-project clangml-transforms.opam \
       /home/opam/clangml-transforms/
COPY --chown=opam clangml-transforms/ \
       /home/opam/clangml-transforms/clangml-transforms/
RUN opam pin add -n clangml-transforms /home/opam/clangml-transforms
RUN opam update && opam upgrade && opam install clangml-transforms
RUN cd /home/opam/memcad && git pull
RUN eval $(opam env) && make -C /home/opam/memcad