# run from root of project repo

# $1 contains the version number to create
git flow release start 

# IMMEDIATELY prepare changelog
echo "### $(git rev-parse --abbrev-ref HEAD | cut -f 2- -d '/') ($(date -Idate))" | cat - CHANGES.md > temp && mv temp CHANGES.md

echo "Now update CHANGES.md out of this (and then test \
		 a little bit until you're happy)"

# if needed, change, clean & update headers
bash util/headache/headache.sh

git ci -am "release v$(git rev-parse --abbrev-ref HEAD | cut -f 2- -d '/')"

git flow finish

git push origin

dune-release tag

git push --tags 


# dune-release publish doc buggy right now
# dune-release bistro =
# dune-release distrib       # Create the distribution archive (with watermarking)
# dune-release publish       # Publish it on the WWW with its documentation
# dune-release opam pkg      # Create an opam package
# dune-release opam submit   # Submit it to OCaml's opam repository
dune-release bistro

echo "See PR in browser"

