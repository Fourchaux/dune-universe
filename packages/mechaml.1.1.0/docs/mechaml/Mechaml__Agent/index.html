<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mechaml__Agent (mechaml.Mechaml__Agent)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">mechaml</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Mechaml__Agent</span></h1></header><p>Scraping agent</p><p>Mechaml is a web agent that allows to :</p><ul><li>Fetch and parse HTML pages</li><li>Analyze, fill and submit HTML forms</li><li>Manages cookies, headers and redirections</li></ul><p>It is build on top of Cohttp, Lwt and Lambdasoup.</p><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-http_status_code"><a href="#type-http_status_code" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>http_status_code</code><code><span class="keyword"> = </span>Cohttp.Code.status_code</code><code></code></div><div class="doc"></div></div><div class="spec type" id="type-http_headers"><a href="#type-http_headers" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>http_headers</code><code><span class="keyword"> = </span>Cohttp.Header.t</code><code></code></div><div class="doc"></div></div><h3>Operations on HTTP responses</h3><div class="spec module" id="module-HttpResponse"><a href="#module-HttpResponse" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="HttpResponse/index.html">HttpResponse</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>The HttpResponse module defines a type and operations to extract content and
metadata from server response</p></div></div><div class="spec type" id="type-result"><a href="#type-result" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>result</code><code><span class="keyword"> = </span><a href="index.html#type-t">t</a><span class="keyword"> * </span><a href="HttpResponse/index.html#type-t">HttpResponse.t</a></code><code></code></div><div class="doc"></div></div><h4>Main operations</h4><div class="spec val" id="val-init"><a href="#val-init" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>init : ?&#8288;max_redirect:int <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Create a new empty agent. <code class="code">~max_redirect</code> indicates how many times the agent
will automatically and consecutively follow the <code class="code">Location</code> header in case of
HTTP 302 or 303 response codes to avoid a redirect loop. Set
to <code class="code">0</code> to disable any automatic redirection.</p></div></div><p>Perform a get request to the specified URI. <code class="code">get &quot;http://www.site/some/url&quot;
   agent</code> sends a HTTP GET request and return the updated state of the agent
together with the server's response</p><div class="spec val" id="val-get"><a href="#val-get" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get : string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-get_uri"><a href="#val-get_uri" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_uri : Uri.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-click"><a href="#val-click" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>click : <a href="../Mechaml/Page/Link/index.html#type-t">Mechaml.Page.Link.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"><p>Same as get, but work directly with links instead of URIs</p></div></div><p>Send a raw post request to the specified URI</p><div class="spec val" id="val-post"><a href="#val-post" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>post : string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-post_uri"><a href="#val-post_uri" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>post_uri : Uri.t <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"></div></div><div class="spec val" id="val-submit"><a href="#val-submit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>submit : <a href="../Mechaml/Page/Form/index.html#type-t">Mechaml.Page.Form.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"><p>Submit a filled form</p></div></div><p>Save some downloaded content in a file</p><div class="spec val" id="val-save_image"><a href="#val-save_image" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>save_image : string <span class="keyword">&#8209;&gt;</span> <a href="../Mechaml/Page/Image/index.html#type-t">Mechaml.Page.Image.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-result">result</a> Lwt.t</code></div><div class="doc"><p><code class="code">save_image &quot;/path/to/myfile.jpg&quot; image agent</code> loads the image using <code class="code">get</code>, open
<code class="code">myfile.jpg</code> and write the content in asynchronously, and return the result</p></div></div><div class="spec val" id="val-save_content"><a href="#val-save_content" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>save_content : string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">save_content &quot;/path/to/myfile.html&quot; content</code> write the specified content in a file
using Lwt's asynchronous IO</p></div></div><h5>Cookies</h5><p> (see Cookiejar)</p><div class="spec val" id="val-cookie_jar"><a href="#val-cookie_jar" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>cookie_jar : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Mechaml/Cookiejar/index.html#type-t">Mechaml.Cookiejar.t</a></code></div><div class="doc"><p>Return the current Cookiejar</p></div></div><div class="spec val" id="val-set_cookie_jar"><a href="#val-set_cookie_jar" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set_cookie_jar : <a href="../Mechaml/Cookiejar/index.html#type-t">Mechaml.Cookiejar.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Set the current Cookiejar</p></div></div><div class="spec val" id="val-add_cookie"><a href="#val-add_cookie" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_cookie : <a href="../Mechaml/Cookiejar/Cookie/index.html#type-t">Mechaml.Cookiejar.Cookie.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Add a single cookie to the current Cookiejar</p></div></div><div class="spec val" id="val-remove_cookie"><a href="#val-remove_cookie" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove_cookie : <a href="../Mechaml/Cookiejar/Cookie/index.html#type-t">Mechaml.Cookiejar.Cookie.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Remove a single cookie from the Cookiejar</p></div></div><h6>Headers</h6><div class="spec val" id="val-client_headers"><a href="#val-client_headers" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>client_headers : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> Cohttp.Header.t</code></div><div class="doc"><p>Return the default headers sent when performing HTTP requests</p></div></div><div class="spec val" id="val-set_client_headers"><a href="#val-set_client_headers" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set_client_headers : Cohttp.Header.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Use the specified headers as new default headers</p></div></div><div class="spec val" id="val-add_client_header"><a href="#val-add_client_header" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_client_header : string <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Add a single pair key/value to the default headers</p></div></div><div class="spec val" id="val-remove_client_header"><a href="#val-remove_client_header" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove_client_header : string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Remove a single pair key/value from the default headers</p></div></div><div class="h7">Redirection</div><div class="spec val" id="val-set_max_redirect"><a href="#val-set_max_redirect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set_max_redirect : int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p>Max redirection to avoid infinite loops (use 0 to disable automatic
redirection)</p></div></div><div class="spec val" id="val-default_max_redirect"><a href="#val-default_max_redirect" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>default_max_redirect : int</code></div><div class="doc"><p>The default maximum consecutive redirections</p></div></div><div class="h8">The Agent Monad</div><p>
This module defines a monad that implicitely manages the state corresponding to the agent
inside the Lwt monad. This is basically the state monad (for <span class="xref-unresolved" title="unresolved reference to &quot;Agent.t&quot;">Agent.t</span>) and the Lwt one stacked</p><div class="spec module" id="module-Monad"><a href="#module-Monad" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Monad/index.html">Monad</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div></body></html>